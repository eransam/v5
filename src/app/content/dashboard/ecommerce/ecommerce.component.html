<div class="app-content content" [id]="'ecommerceId'">
  <div class="content-wrapper">
    <div class="content-header row mb-1"></div>
    <div class="content-body">
      <!-- eCommerce statistic ------------------------------------------------------------------------------------------------------------------------>
      <!-- תשלום -->
      <div class="row" style="direction: rtl">
        <div class="col-xl-2 col-lg-6 col-12" (click)="shows_grower_payment()">
          <div class="card pull-up">
            <div class="card-content">
              <div
                *ngIf="isLoading_grower_payment"
                class="loader_grower_cart"
              ></div>
              <div
                *ngIf="!isLoading_grower_payment"
                class="card-body card_padding"
              >
                <div class="media d-flex">
                  <div class="media-body text-left">
                    <h3 class="info">תשלום</h3>
                    <h6>תשלום</h6>
                  </div>
                  <div>
                    <i
                      class="icon-basket-loaded info font-large-2 float-right"
                    ></i>
                  </div>
                </div>
                <div class="mb-0 mt-1">
                  <ngb-progressbar
                    height="7px"
                    width="100%"
                    type="gradient-x-info"
                    [value]="80"
                  ></ngb-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- <button (click)="test_eran()">test_eran()</button> -->
        <!-- רב שנתי -->
        <div class="col-xl-2 col-lg-6 col-12" (click)="shows_rav_shnati()">
          <div class="card pull-up">
            <div class="card-content">
              <div
                *ngIf="isLoading_rav_shnati"
                class="loader_grower_cart"
              ></div>
              <div class="card-body card_padding" *ngIf="!isLoading_rav_shnati">
                <div class="media d-flex">
                  <div class="media-body text-left">
                    <h3 class="info">רב שנתי</h3>
                    <h6>פרטים מורחבים</h6>
                  </div>
                  <div>
                    <i
                      class="icon-basket-loaded info font-large-2 float-right"
                    ></i>
                  </div>
                </div>
                <div class="mb-0 mt-1">
                  <ngb-progressbar
                    height="7px"
                    width="100%"
                    type="gradient-x-info"
                    [value]="80"
                  ></ngb-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- תעודות -->

        <div
          class="col-xl-2 col-lg-6 col-12"
          (click)="shows_certificates_by_grewernum()"
        >
          <div class="card pull-up">
            <div class="card-content">
              <div
                *ngIf="this.isLoading_cartificate"
                class="loader_grower_cart"
              ></div>
              <div
                class="card-body card_padding"
                *ngIf="!this.isLoading_cartificate"
              >
                <div class="media d-flex">
                  <div class="media-body text-left">
                    <h3 class="warning">תעודות</h3>
                    <h6>פרטי תעודות</h6>
                  </div>
                  <div>
                    <i
                      class="icon-pie-chart warning font-large-2 float-right"
                    ></i>
                  </div>
                </div>
                <div class="mb-0 mt-1">
                  <ngb-progressbar
                    height="7px"
                    width="100%"
                    type="gradient-x-warning"
                    [value]="65"
                  >
                  </ngb-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- סיכום חודשי -->
        <div class="col-xl-2 col-lg-6 col-12" (click)="shows_monthiy()">
          <div class="card pull-up">
            <div class="card-content">
              <div
                *ngIf="this.isLoading_monthly"
                class="loader_grower_cart"
              ></div>
              <div
                *ngIf="!this.isLoading_monthly"
                class="card-body card_padding"
              >
                <div class="media d-flex">
                  <div class="media-body text-left">
                    <h3 class="success">סיכום חודשי</h3>
                    <h6>סיכום חודשי</h6>
                  </div>
                  <div>
                    <i
                      class="icon-user-follow success font-large-2 float-right"
                    ></i>
                  </div>
                </div>
                <div class="mb-0 mt-1">
                  <ngb-progressbar
                    height="7px"
                    width="100%"
                    type="gradient-x-success"
                    [value]="75"
                  ></ngb-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- כרטיס מגדל -->
        <div class="col-xl-2 col-lg-6 col-12" (click)="grower_cart()">
          <div class="card pull-up">
            <div class="card-content">
              <div
                *ngIf="this.isLoading_grower_cart"
                class="loader_grower_cart"
              ></div>
              <div
                class="card-body card_padding"
                *ngIf="!this.isLoading_grower_cart"
              >
                <div class="media d-flex">
                  <div class="media-body text-left">
                    <h3 class="danger">כרטיס מגדל</h3>
                    <h6>פרטי מגדל</h6>
                  </div>
                  <div>
                    <i class="icon-heart danger font-large-2 float-right"></i>
                  </div>
                </div>
                <div class="mb-0 mt-1">
                  <ngb-progressbar
                    height="7px"
                    width="100%"
                    type="gradient-x-danger"
                    [value]="85"
                  ></ngb-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--חיפוש לפי שנה-->
        <div class="col-xl-2 col-lg-6 col-12">
          <div class="card pull-up search_by_year">
            <div class="card-content">
              <div class="card-body card_padding">
                <div class="media d-flex" style="height: 99px">
                  <div
                    class="year-select rtl_Style"
                    style="
                      display: flex;
                      align-items: stretch;
                      font-size: 25px;
                      font-weight: bold;
                      margin: auto;
                    "
                  >
                    <select
                      [(ngModel)]="chosenYear"
                      (change)="onYearChange()"
                      style="width: 200px; height: 60px"
                    >
                      <option *ngFor="let year of years" [value]="year">
                        {{ year }}
                      </option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--/ eCommerce statistic ------   ------------------------------------------------------------------------------------------------------------------>

      <!-- Products sell and New Orders ------------------------------------------------------------------------------------------------------------------------>
      <div class="row">
        <!-- טבלה התראות ------------------------------------------------------------------------------------------------------------------------>
        <div
          class="col-xl-2 col-12"
          style="background-color: white; height: fit-content"
        >
          <div class="row match_height">
            <div id="recent-transactions" class="col-12">
              <div class="table-responsive card-micsa">
                <div class="card-header"></div>
                <div class="card-content">
                  <div class="eexel_and_total">
                    <div class="importBth"></div>

                    <div>
                      <h1 class="rtl_Style" style="margin-top: 12px">התראות</h1>
                    </div>
                  </div>
                  <div
                    class="table-container"
                    fxFlex="auto"
                    [perfectScrollbar]="config"
                  >
                    <table
                      class="table table-hover border_bottom detailsTable"
                      style="direction: rtl"
                    >
                      <thead class="detailsTable">
                        <!-- מגדל יוש -->
                        <tr
                          *ngIf="
                            this.userDetails_more_info &&
                            this.userDetails_more_info.length > 0 &&
                            this.userDetails_more_info[0]?.v_YzYosh
                          "
                        >
                          <div
                            *ngIf="
                              this.userDetails_more_info[0]?.v_YzYosh === 1
                            "
                          >
                            <th scope="col" class="border-top-0">מגדל יו''ש</th>
                            <th scope="col" class="border-top-0">
                              <div
                                [ngSwitch]="
                                  this.userDetails_more_info[0]?.v_YzYosh
                                "
                              >
                                <span
                                  *ngSwitchCase="'1'"
                                  style="color: green; font-size: 2rem"
                                  >√</span
                                >
                                <span
                                  *ngSwitchDefault
                                  style="color: red; font-size: 2rem"
                                  >X</span
                                >
                              </div>
                            </th>
                          </div>
                        </tr>

                        <!--מגדל גידול עצמי-->

                        <tr
                          *ngIf="
                            this.userDetails_more_info &&
                            this.userDetails_more_info.length > 0 &&
                            this.userDetails_more_info[0]?.v_SelfGrower
                          "
                        >
                          <div
                            *ngIf="
                              userDetails_more_info[0]?.v_SelfGrower === '1'
                            "
                          >
                            <th scope="col" class="border-top-0">
                              מגדל גידול עצמי
                            </th>
                            <th scope="col" class="border-top-0">
                              <div
                                [ngSwitch]="
                                  userDetails_more_info[0]?.v_SelfGrower
                                "
                              >
                                <span
                                  *ngSwitchCase="'1'"
                                  style="color: green; font-size: 2rem"
                                  >√</span
                                >
                              </div>
                            </th>
                          </div>
                        </tr>

                        <!-- מגדל דור ב -->
                        <tr
                          *ngIf="
                            this.userDetails_more_info &&
                            this.userDetails_more_info.length > 0 &&
                            this.userDetails_more_info[0]?.v_Dor_bet
                          "
                        >
                          <div
                            *ngIf="userDetails_more_info[0]?.v_Dor_bet === '1'"
                          >
                            <th scope="col" class="border-top-0">
                              מגדל דור ב'
                            </th>
                            <th scope="col" class="border-top-0">
                              <div
                                [ngSwitch]="userDetails_more_info[0]?.v_Dor_bet"
                              >
                                <span
                                  *ngSwitchCase="'1'"
                                  style="color: green; font-size: 2rem"
                                  >√</span
                                >
                                <span
                                  *ngSwitchDefault
                                  style="color: red; font-size: 2rem"
                                  >X</span
                                >
                              </div>
                            </th>
                          </div>
                        </tr>

                        <!-- רישיון עסק -->
                        <tr *ngIf="McsRishaion_Esek_number_type">
                          <div *ngIf="McsRishaion_Esek_number_type !== 0">
                            <th scope="col" class="border-top-0">
                              {{ businessLicense_all_details }}
                            </th>
                            <th>
                              <div>
                                <span style="color: green; font-size: 2rem"
                                  >√</span
                                >
                              </div>
                            </th>
                          </div>
                        </tr>

                        <!-- מגדל צריכה עצמית -->

                        <tr
                          *ngIf="
                            this.userDetails_more_info &&
                            this.userDetails_more_info.length > 0 &&
                            this.userDetails_more_info[0]?.v_SelfConsum
                          "
                        >
                          <div
                            *ngIf="
                              userDetails_more_info[0]?.v_SelfConsum === '1'
                            "
                          >
                            <th scope="col" class="border-top-0">
                              מגדל צריכה עמצאית
                            </th>
                            <th scope="col" class="border-top-0">
                              <div
                                [ngSwitch]="
                                  userDetails_more_info[0]?.v_SelfConsum
                                "
                              >
                                <span
                                  *ngSwitchCase="'1'"
                                  style="color: green; font-size: 2rem"
                                  >√</span
                                >
                                <span
                                  *ngSwitchDefault
                                  style="color: red; font-size: 2rem"
                                  >X</span
                                >
                              </div>
                            </th>
                          </div>
                        </tr>

                        <!-- אישור שוט -->
                        <tr *ngIf="shot_confirmation === '1'">
                          <th scope="col" class="border-top-0">אישור שוט</th>

                          <th>
                            <div>
                              <span style="color: green; font-size: 2rem">
                                √
                              </span>
                            </div>
                          </th>
                        </tr>

                        <!--  עזבון -->
                        <tr *ngIf="checkIzavon">
                          <th
                            scope="col"
                            class="border-top-0"
                            scope="col"
                            class="border-top-0"
                            align="left"
                            style="cursor: pointer"
                            (click)="Popup_Izavon()"
                            id="Popup_Izavon"
                          >
                            עיזבון
                            <span style="color: green; font-size: 2rem">
                              √
                              <i class="fas fa-angle-left fa-lg"></i>
                            </span>
                          </th>
                        </tr>

                        <!--  התראה בן זוג שותף -->
                        <tr *ngIf="Check_Ben_Zug_Shotaf">
                          <th scope="col" class="border-top-0">
                            בן זוג שותף
                            <span style="color: green; font-size: 2rem">
                              √
                            </span>
                          </th>
                        </tr>

                        <!-- התראה כפל גידול-->
                        <tr *ngIf="Check_v_name_kaful">
                          <th scope="col" class="border-top-0">
                            כפל גידול
                            <span style="color: green; font-size: 2rem">
                              √
                            </span>
                          </th>
                        </tr>

                        <!-- התראה כתובת שונה למגדל-->
                        <tr *ngIf="yzrn_have_other_addr">
                          <th
                            scope="col"
                            class="border-top-0"
                            scope="col"
                            class="border-top-0"
                            align="left"
                            style="cursor: pointer"
                            (click)="Popup_Grower_Other_Addr()"
                            id="Popup_Grower_Other_Addr"
                          >
                            קיים למגדל כתובת מגורים שונה
                            <span style="color: green; font-size: 2rem">
                              √
                              <i class="fas fa-angle-left fa-lg"></i>
                            </span>
                          </th>
                        </tr>

                        <!-- התראה שם מגדל ישן-->
                        <tr *ngIf="checkOldGrowerName">
                          <th
                            scope="col"
                            class="border-top-0"
                            scope="col"
                            class="border-top-0"
                            align="left"
                            style="cursor: pointer"
                            (click)="Popup_Old_Grower_Name()"
                            id="Popup_Grower_Other_Addr"
                          >
                            שם מגדל ישן
                            <span style="color: green; font-size: 2rem">
                              √
                              <i class="fas fa-angle-left fa-lg"></i>
                            </span>
                          </th>
                        </tr>
                      </thead>

                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--סיום טבלה התראות ------------------------------------------------------------------------------------------------------------------------>

        <!-- טבלה מכסות פטם והודים------------------------------------------------------------------------------------------------------------------------>

        <div
          *ngIf="
            (mihsotPetem.length > 0 || mihsotHodim.length > 0) &&
            mihsot.length > 0
          "
          class="col-xl-3 col-12"
        >
          <div *ngIf="isLoading_userDet" class="loader"></div>
          <div class="row match_height" *ngIf="!isLoading_userDet">
            <div id="recent-transactions" class="col-12">
              <div
                class="card card-micsa"
                style="padding-right: 15px !important"
              >
                <div class="card-header"></div>
                <div class="card-content">
                  <!-- <div class="exel_and_total"></div> -->

                  <div class="table-container micsotStyle2">
                    <!-- טבלת מכסות פטם -->
                    <div *ngIf="mihsotPetem.length > 0">
                      <div>
                        <h1 class="rtl_Style">מכסת פטם :</h1>
                      </div>

                      <tr>
                        <td><B>שותפות:</B></td>
                        <td class="text-truncate row_padding">
                          <div
                            *ngFor="let obj of arrPartnersPetem; let i = index"
                          >
                            <div *ngIf="!obj?.numGroup; else elseBlock"></div>
                            <ng-template
                              #elseBlock
                              style="padding: none !important"
                            >
                              <ng-container *ngIf="isFirstUniqueValue(obj, i)">
                                <div *ngIf="obj.numGroup">
                                  <button
                                    id="gidolHotzBtn"
                                    style="
                                      color: blue;
                                      background-color: white !important;
                                      border: none;
                                    "
                                    (click)="open_PopupPetemPartnersComponent()"
                                  >
                                    {{ obj.partners.length }} ({{
                                      obj.numGroup
                                    }})
                                  </button>
                                </div>
                                <ng-container
                                  *ngIf="hasMultipleUniqueValues(obj)"
                                >
                                  <span>&nbsp;</span>
                                </ng-container>
                              </ng-container>
                            </ng-template>
                          </div>
                        </td>
                      </tr>

                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsotPetem">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- טבלת מכסות פטם סיום-->

                    <!-- טבלת מכסות הודים -->
                    <div *ngIf="mihsotHodim.length > 0">
                      <h1 class="rtl_Style">מכסת הודים:</h1>
                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsotHodim">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- טבלת מכסות הודים סיום-->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--סיום טבלה מכסות פטם והודים------------------------------------------------------------------------------------------------------------------------>

        <!-- טבלה מכסות ביצי הטלה------------------------------------------------------------------------------------------------------------------------>
        <div
          *ngIf="
            (mihsotPetem.length > 0 || mihsotHodim.length > 0) &&
            mihsot.length > 0
          "
          class="col-xl-3 col-12"
        >
          <div *ngIf="isLoading_userDet" class="loader"></div>
          <div class="row match_height" *ngIf="!isLoading_userDet">
            <div id="recent-transactions" class="col-12">
              <div class="card card-micsa">
                <div class="card-header"></div>
                <div class="card-content">
                  <div class="exel_and_total">
                    <div>
                      <p style="direction: rtl">
                        קבועה: {{ totalMicsaKvoha | numberFormat }}
                      </p>
                      <p style="direction: rtl">
                        לתשלום: {{ totalMicsaToPay | numberFormat }}
                      </p>
                    </div>
                    <div>
                      <h1 class="rtl_Style">מכסת ביצים</h1>
                    </div>
                  </div>

                  <div class="table-container micsotStyle">
                    <!-- טבלת מכסות ביצים  -->
                    <div style="overflow-x: hidden" *ngIf="mihsot.length > 0">
                      <div class="rtl_Style">
                        <tr>
                          <td style="margin-left: 50px"></td>

                          <td><B>ג''ח</B></td>
                          <td class="text-truncate row_padding">
                            <div *ngIf="this.userDetails[0]?.cdgdl.length > 0">
                              <button
                                id="gidolHotzBtn"
                                style="
                                  color: blue;
                                  background-color: white !important;
                                  border: none;
                                "
                                (click)="getPartner([obj])"
                              >
                                {{ this.userDetails[0]?.cdgdl }} - קיים ג''ח
                              </button>
                            </div>
                          </td>
                        </tr>
                      </div>
                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsot">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- טבלת מכסות ביצים סיום -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ---------- תצוגה 2 ----------->

        <!-- טבלה מכסות פטם והודים------------------------------------------------------------------------------------------------------------------------>
        <div
          *ngIf="
            (mihsotPetem.length > 0 || mihsotHodim.length > 0) &&
            mihsot.length === 0
          "
          class="col-xl-6 col-12"
        >
          <div *ngIf="isLoading_userDet" class="loader"></div>
          <div class="row match_height" *ngIf="!isLoading_userDet">
            <div id="recent-transactions" class="col-12">
              <div
                class="card card-micsa"
                style="padding-right: 15px !important"
              >
                <div class="card-header"></div>
                <div class="card-content">
                  <div class="exel_and_total"></div>

                  <div class="table-container micsotStyle">
                    <!-- טבלת מכסות פטם -->
                    <div *ngIf="mihsotPetem.length > 0">
                      <div>
                        <h1 class="rtl_Style">מכסת פטם</h1>
                      </div>
                      <tr>
                        <td><B>שותפות:</B></td>
                        <td class="text-truncate row_padding">
                          <div
                            *ngFor="let obj of arrPartnersPetem; let i = index"
                          >
                            <div *ngIf="!obj?.numGroup; else elseBlock"></div>
                            <ng-template
                              #elseBlock
                              style="padding: none !important"
                            >
                              <ng-container *ngIf="isFirstUniqueValue(obj, i)">
                                <div *ngIf="obj.numGroup">
                                  <button
                                    id="gidolHotzBtn"
                                    style="
                                      color: blue;
                                      background-color: white !important;
                                      border: none;
                                    "
                                    (click)="open_PopupPetemPartnersComponent()"
                                  >
                                    {{ obj.partners.length }} ({{
                                      obj.numGroup
                                    }})
                                  </button>
                                </div>
                                <ng-container
                                  *ngIf="hasMultipleUniqueValues(obj)"
                                >
                                  <span>,</span>
                                </ng-container>
                              </ng-container>
                            </ng-template>
                          </div>
                        </td>
                      </tr>

                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <!-- <th scope="col" class="border-top-0">סוג תוספת:</th> -->
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsotPetem">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <!-- <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa7 }}
                            </td> -->

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- טבלת מכסות פטם סיום-->

                    <!-- טבלת מכסות הודים -->
                    <div *ngIf="mihsotHodim.length > 0">
                      <h1 class="rtl_Style">מכסת הודים:</h1>
                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsotHodim">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- טבלת מכסות הודים סיום-->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--סיום טבלה מכסות פטם והודים------------------------------------------------------------------------------------------------------------------------>
        </div>

        <!--סיום טבלה מכסות ------------------------------------------------------------------------------------------------------------------------>

        <!-- -------------------- תצוגה 3 ------------------------->

        <!-- טבלה מכסות ביצי הטלה------------------------------------------------------------------------------------------------------------------------>
        <div
          *ngIf="
            mihsot.length > 0 &&
            mihsotPetem.length === 0 &&
            mihsotHodim.length === 0
          "
          class="col-xl-6 col-12"
        >
          <div *ngIf="isLoading_userDet" class="loader"></div>
          <div class="row match_height" *ngIf="!isLoading_userDet">
            <div id="recent-transactions" class="col-12">
              <div class="card card-micsa">
                <div class="card-header"></div>
                <div class="card-content">
                  <div class="exel_and_total">
                    <div>
                      <p style="direction: rtl">
                        קבועה: {{ totalMicsaKvoha | numberFormat }}
                      </p>
                      <p style="direction: rtl">
                        לתשלום: {{ totalMicsaToPay | numberFormat }}
                      </p>
                    </div>
                    <div>
                      <h1 class="rtl_Style">מכסת ביצים</h1>
                    </div>
                  </div>

                  <div class="table-container micsotStyle">
                    <!-- טבלת מכסות ביצים  -->
                    <div style="overflow-x: hidden" *ngIf="mihsot.length > 0">
                      <div class="rtl_Style">
                        <tr>
                          <td style="margin-left: 50px"></td>

                          <td><B>ג''ח</B></td>
                          <td class="text-truncate row_padding">
                            <div *ngIf="this.userDetails[0]?.cdgdl.length > 0">
                              <button
                                id="gidolHotzBtn"
                                style="
                                  color: blue;
                                  background-color: white !important;
                                  border: none;
                                "
                                (click)="getPartner([obj])"
                              >
                                {{ this.userDetails[0]?.cdgdl }} - קיים ג''ח
                              </button>
                            </div>
                          </td>
                        </tr>
                      </div>
                      <table
                        class="table table-hover border_bottom detailsTable"
                        style="direction: rtl"
                      >
                        <thead class="detailsTable">
                          <tr>
                            <th scope="col" class="border-top-0">סוג:</th>
                            <th scope="col" class="border-top-0">
                              שם סוג מכסה:
                            </th>
                            <th scope="col" class="border-top-0">כמות</th>
                            <th scope="col" class="border-top-0">מתאריך</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let row of mihsot">
                            <td class="text-truncate row_padding">
                              {{ row.mi_sug_mcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.nameSugMcsa }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_kamut | numberFormat }}
                            </td>

                            <td class="text-truncate row_padding">
                              {{ row.mi_date_from | date : "dd/MM/yyyy" }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <!-- טבלת מכסות ביצים סיום -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          *ngIf="
            mihsot.length === 0 &&
            mihsotPetem.length === 0 &&
            mihsotHodim.length === 0
          "
          class="col-xl-6 col-12"
        ></div>

        <!-- טבלת פרטי מגדל ------------------------------------------------------------------------------------------------------------------------>

        <div *ngIf="true" class="col-xl-4 col-lg-12 growerDetails">
          <m-card
            [options]="options"
            (reloadFunction)="reloadNewOrders($event)"
          >
            <ng-container mCardContent>
              <div id="new-orders" class="media-list position-relative">
                <div
                  class="table-responsive card-micsa"
                  style="padding-right: 3%; padding-left: 3%"
                >
                  <div>
                    <div class="card-header"></div>
                    <h1>פרטי מגדל</h1>
                    <table class="table" style="direction: rtl">
                      <tbody
                        *ngIf="
                          this.userDetails_more_info &&
                          this.userDetails_more_info.length > 0
                        "
                      >
                        <tr>
                          <td><B>שם יצרן</B></td>

                          <td>
                            {{ this.userDetails_more_info[0]?.v_shem_yzrn }}
                          </td>

                          <td><B>מספר יצרן</B></td>
                          <td>{{ this.userDetails_more_info[0]?.v_yzrn }}</td>
                          <td
                            align="left"
                            style="cursor: pointer"
                            (click)="openPopup_Of_OldGrower()"
                            id="openPopup_Of_OldGrowerBtn"
                          >
                            <i class="fas fa-angle-left fa-lg"></i>
                          </td>
                        </tr>
                        <tr>
                          <td><B>כתובת</B></td>
                          <td>
                            {{
                              this.userDetails_more_info[0]?.v_ktovet +
                                "," +
                                this.userDetails_more_info[0]?.v_ktovet1
                            }}
                          </td>
                          <td></td>
                          <td></td>
                          <td></td>
                        </tr>

                        <tr>
                          <td><B>נחלה</B></td>
                          <td>
                            {{ userDetails_more_info[0]?.v_msk }}
                          </td>
                          <td></td>
                          <td></td>
                          <td></td>
                        </tr>

                        <tr>
                          <td><B>ת.ז</B></td>
                          <td>{{ this.userDetails_more_info[0]?.v_zehut }}</td>

                          <td><B>טלפון</B></td>
                          <td>
                            {{ this.userDetails_more_info[0]?.v_tel1 }}
                          </td>
                          <td></td>
                        </tr>
                        <tr>
                          <td><B>ישוב</B></td>
                          <td>
                            {{ this.userDetails_more_info[0]?.v_shem_yeshuv }}
                          </td>

                          <td>
                            <B>טלפון נוסף</B>
                          </td>
                          <td>
                            {{ this.userDetails_more_info[0]?.v_tel }}
                          </td>
                          <td></td>
                        </tr>
                        <tr>
                          <td><B>סוג מגדל</B></td>
                          <td [ngSwitch]="userDetails_more_info[0]?.Rashi">
                            <span
                              *ngSwitchCase="'1'"
                              style="
                                font-size: 19px;
                                font-weight: 600;
                                color: green;
                              "
                              >ראשי</span
                            >
                            <span
                              *ngSwitchCase="'0'"
                              style="
                                font-size: 19px;
                                font-weight: 600;
                                color: red;
                              "
                              >שותף</span
                            >
                            <span
                              *ngSwitchDefault
                              style="
                                font-size: 19px;
                                font-weight: 600;
                                color: blue;
                              "
                              >פרטני</span
                            >
                          </td>
                          <td><B>מייל</B></td>
                          <td>
                            {{ this.userDetails_more_info[0]?.v_Email }}
                          </td>
                          <td></td>
                        </tr>
                        <tr
                          *ngFor="let row of kannatNum_and_oldMegadelNum"
                          class=""
                        >
                          <th>{{ row.NameMsvkExt }}</th>
                          <th>{{ row.YazExtrnl }}</th>
                          <td></td>
                          <td></td>
                          <td></td>
                        </tr>

                        <tr>
                          <td
                            style="cursor: pointer; color: green"
                            (click)="openPopup_more_info_grower()"
                            id="moreInfoBtn"
                          >
                            פרטים נוספים
                            <i class="fas fa-angle-left fa-lg"></i>
                          </td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </ng-container>
          </m-card>
        </div>
        <!-- סיום טבלת פרטי מגדל ------------------------------------------------------------------------------------------------------------------------>
      </div>
      <!-- טבלת פרטי משקים ------------------------------------------------------------------------------------------------------------------------>
      <div class="farm-det">
        <!-- פרטי אתר מורחבים -->
        <div class="row match_height farm_more_det">
          <div id="recent-transactions" class="col-12">
            <div class="card" style="padding-right: 30px">
              <div class="card-header"></div>
              <div class="card-content">
                <div class="exel_and_total">
                  <!-- <div class="importBth">
                    <div class="justify-content">
                      <img
                        class="logoIngStyle"
                        src="assets/images/logo/excel.png"
                        alt="Image"
                        (click)="getExcelDataFarmDetails()"
                      />
                    </div>
                  </div> -->
                </div>
                <div *ngIf="isLoading_FarmDetails" class="loader"></div>
                <div
                  *ngIf="!isLoading_FarmDetails"
                  style="
                    overflow-y: auto !important;
                    overflow-x: auto !important;
                    height: 658px !important;
                  "
                >
                  <h3
                    class="main_table_tatle"
                    style="
                      text-align: end;
                      font-size: 30px;
                      font-weight: bold;
                      color: #5b5bf8;
                    "
                  >
                    פרטי אתר
                  </h3>
                  <table
                    class=""
                    style="direction: rtl; width: 100%; margin-bottom: 50px"
                  >
                    <thead class="detailsTable">
                      <tr>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          מס אתר
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          שם אתר
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          ישוב
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          שלוחה
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          סוג אתר
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          סוג מבנה
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          היתר איכלוס
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          תנאי אימון
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          מס גוש
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          ג''ח
                        </th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr *ngFor="let row of this.farm_det_new">
                        <td style="width: 100px">{{ row.farm_num }}</td>
                        <td style="width: 100px">{{ row.farm_name }}</td>
                        <td style="width: 100px">{{ row.settlement_name }}</td>
                        <td style="width: 100px">
                          {{ row.belonging_group_name }}
                        </td>
                        <td style="width: 100px">{{ row.farm_type }}</td>
                        <td style="width: 100px">{{ row.building_name }}</td>
                        <td style="width: 100px">
                          <div [ngSwitch]="row.itar_hiclos">
                            <span
                              *ngSwitchCase="'1'"
                              style="color: green; font-size: 2rem"
                              >√</span
                            >
                            <span
                              *ngSwitchDefault
                              style="color: red; font-size: 2rem"
                              >X</span
                            >
                          </div>
                        </td>
                        <td style="width: 100px">
                          <div [ngSwitch]="row.tnahi_imon">
                            <span
                              *ngSwitchCase="'0'"
                              style="color: green; font-size: 2rem"
                              >√</span
                            >
                            <span
                              *ngSwitchDefault
                              style="color: red; font-size: 2rem"
                              >X</span
                            >
                          </div>
                        </td>
                        <td style="width: 100px">{{ row.block_num }}</td>

                        <td style="width: 100px">{{ row.pa_Counter }}</td>
                      </tr>
                    </tbody>
                    <br />
                    <h3
                      class="main_table_tatle"
                      style="font-size: 30px; font-weight: bold; color: #5b5bf8"
                    >
                      פרטי להקה
                    </h3>

                    <thead class="detailsTable">
                      <tr>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          מס להקה
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          תאריך בקיעה
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          גיל בחודשים
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          גיל בשבועות
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          איכלוס
                        </th>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                      </tr>
                    </thead>

                    <tbody>
                      <tr *ngFor="let row of this.farm_det_new">
                        <td style="width: 100px">{{ row.flock_num }}</td>
                        <td style="width: 100px">
                          {{ row.flock_hatch_date | date : "dd/MM/yyyy" }}
                        </td>
                        <td style="width: 100px">{{ row.flock_month_age }}</td>
                        <td style="width: 100px">{{ row.flock_week_age }}</td>
                        <td style="width: 100px">
                          {{ row.hiclos_number | number : "1.0-0" }}
                        </td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                      </tr>
                    </tbody>
                    <br />

                    <thead
                      *ngIf="
                        farm_det_new &&
                        farm_det_new[0] &&
                        farm_det_new[0]?.belonging_group_name ===
                          'תרנגולות - הטלה' &&
                        (farm_det_new[0]?.farm_type === 'אחר' ||
                        farm_det_new[0]?.farm_type === 'חופש')
                      "
                      class="detailsTable"
                    >
                      <tr>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          קיבולת 350
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          קיבולת 750
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          זן
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          מקדם
                        </th>

                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        >
                          מכסת פרגיות
                        </th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                        <th
                          scope="col"
                          class="border-top-0 table_tatle"
                          style="width: 100px"
                        ></th>
                      </tr>
                    </thead>

                    <tbody
                      *ngIf="
                        farm_det_new &&
                        farm_det_new[0] &&
                        farm_det_new[0]?.belonging_group_name ===
                          'תרנגולות - הטלה' &&
                        (farm_det_new[0]?.farm_type === 'אחר' ||
                        farm_det_new[0]?.farm_type === 'חופש')
                      "
                    >
                      <tr *ngFor="let row of this.farm_det_new">
                        <td style="width: 100px">
                          {{ row.kibolet_lul | number : "1.0-0" }}
                        </td>
                        <td style="width: 100px">
                          {{ row.calc750 | number : "1.0-0" }}
                        </td>
                        <td style="width: 100px">
                          {{ row.zan_det[0]?.zan }} -
                          {{ row.zan_det[0]?.zan_name }}
                        </td>
                        <td style="width: 100px">
                          {{ row.zan_det[0].number }}
                        </td>
                        <td style="width: 100px">
                          {{ row.micsat_pargiot | number : "1.0-0" }}
                        </td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                        <td style="width: 100px"></td>
                      </tr>
                    </tbody>
                  </table>
                  <div></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- טבלת פרטי אתרים מקוצרת -->
        <div
          class="row match_height sort_farms"
          style="
            display: flex;
            width: 100%;
            justify-content: end;
            margin-left: 10px;
          "
        >
          <div id="recent-transactions" class="col-12">
            <div class="card">
              <div class="card-header"></div>
              <div class="card-content">
                <div class="" style="padding: 15px">
                  <div class="importBth">
                    <div class="justify-content">
                      <!-- <img
                        class="logoIngStyle"
                        src="assets/images/logo/excel.png"
                        alt="Image"
                        (click)="getExcelDataFarmDetails()"
                      /> -->
                    </div>
                  </div>
                  <div class="check">
                    <div style="display: flex">
                      <div style="direction: rtl">
                        פעילים: {{ this.new_Active_FarmDetails.length }} לא
                        פעילים:
                        {{ this.new_Not_Active_FarmDetails.length }}
                      </div>
                    </div>

                    <div
                      *ngIf="keys_of_categorizedArrays.length > 1"
                      style="margin-left: 30px"
                      class="site_by_shlohot_btn"
                    >
                      <div>
                        <select
                          [(ngModel)]="selectedCategory"
                          (change)="selectCategory($event.target.value)"
                          class="form-select form-select-lg"
                          style="font-size: larger"
                        >
                          <option value="" disabled selected>שלוחה</option>
                          <option
                            *ngFor="let obj of keys_of_categorizedArrays"
                            [value]="obj"
                            [selected]="selectedCategory === obj"
                          >
                            {{ getCategoryLabel(obj) }}
                          </option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="isLoading_FarmDetails" class="loader"></div>
                  <div
                    *ngIf="!isLoading_FarmDetails"
                    style="
                      overflow-y: auto !important;
                      overflow-x: auto !important;
                      height: 700px !important;
                    "
                  >
                    <table class="" style="direction: rtl; width: 100%">
                      <thead class="detailsTable">
                        <tr>
                          <th scope="col" class="border-top-0">אתרים</th>

                          <th scope="col" class="border-top-0">שלוחה</th>

                          <th scope="col" class="border-top-0">סטטוס</th>


                        </tr>
                      </thead>

                      
                      <tbody>
                        <tr *ngFor="let row of this.farm_start_det">
                          <td
                            *ngIf="row.is_hen_house_split !== 1"
                            [ngClass]="[
                              row.farm_status_id === 1
                                ? 'avtice_site_class'
                                : 'not_avtice_site_class',
                              row.code === the_chosen_farm
                                ? 'chosen_site'
                                : 'not_chosen_site'
                            ]"
                            id="gidolHotzBtn"
                            (click)="get_more_farm_det_by_farm_num(row.code)"
                          >
                            {{ row.code }} - {{ row.name }}
                          </td>

                          <td
                            *ngIf="row.is_hen_house_split !== 1"
                            [ngClass]="[
                              row.farm_status_id === 1
                                ? 'avtice_site_class'
                                : 'not_avtice_site_class',
                              row.code === the_chosen_farm
                                ? 'chosen_site'
                                : 'not_chosen_site'
                            ]"
                          >
                            {{ row.shloha_name }}
                          </td>


                          <td
                          *ngIf="row.is_hen_house_split !== 1"
                          [ngClass]="[
                            row.farm_status_id === 1
                              ? 'avtice_site_class'
                              : 'not_avtice_site_class',
                            row.code === the_chosen_farm
                              ? 'chosen_site'
                              : 'not_chosen_site'
                          ]"
                        >
                          <p *ngIf="row.farm_status_id === 2 ">לא פעיל</p>
                          <p *ngIf="row.farm_status_id === 1 "> פעיל</p>

                        </td>


                        </tr>
                      </tbody>
                    </table>
                    <div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--סיום טבלת פרטי משקים ------------------------------------------------------------------------------------------------------------------------>

      <!-- Modal ------------------------------------------------------------------------------------------------------------------------>
      <div
        class="modal"
        id="growerModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="vertical-alignment-helper">
          <div class="modal-dialog vertical-align-center">
            <div class="modal-content" style="width: 500px">
              <app-grower-details
                *ngIf="modalGrowerID"
                [growerID]="modalGrowerID"
              ></app-grower-details>
            </div>
          </div>
        </div>
      </div>

      <button
        id="btnModalGrower"
        style="display: none"
        type="button"
        class="btn btn-primary"
        data-toggle="modal"
        data-target="#growerModal"
      ></button>

      <!-- Modal -->
      <div
        class="modal"
        id="growerModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="vertical-alignment-helper">
          <div class="modal-dialog vertical-align-center">
            <div class="modal-content" style="width: 500px">
              <app-grower-details
                *ngIf="modalGrowerID"
                [growerID]="modalGrowerID"
              ></app-grower-details>
            </div>
          </div>
        </div>
      </div>
      <!--and Modal ------------------------------------------------------------------------------------------------------------------------>
    </div>
  </div>
</div>
